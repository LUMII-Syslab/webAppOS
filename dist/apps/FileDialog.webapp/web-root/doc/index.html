<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>FileDialog App API.txt</title><link rel="stylesheet" type="text/css" href="Default.css" /><script type="text/javascript" src="../../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0.2 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="FileDialog_App_API"></a><a name="Topic99"></a><div class="CTopic TFile LTextFile first">
 <div class="CTitle">FileDialog App API</div>
</div>

<a name="Introduction"></a><a name="Topic184"></a><div class="CTopic TGroup LTextFile">
 <div class="CTitle">Introduction</div>
 <div class="CBody"><p>The FileDialog app contains just one file FileDialog.html, which relies on the shipped FileBrowser app to provide the dialog window. (We can switch later to another undelying app, but the communication with FileDialog.html will remain the same.)</p><p>FileDialog.html is designed to be embedded inside iframes.</p></div>
</div>

<a name="Creating_a_File_Dialog"></a><a name="Topic345"></a><div class="CTopic TGroup LTextFile">
 <div class="CTitle">Creating a File Dialog</div>
 <div class="CBody"><p>Create an iframe with the URL pointing to FileDialog.html with a query string containing the following 3 arguments:</p><table class="CDefinitionList"><tr><td class="CDLEntry">type</td><td class="CDLDefinition"><p>dialog type: &quot;open&quot;, &quot;save&quot;, &quot;dir&quot; (the latter is for choosing a directory, not a file)</p></td></tr><tr><td class="CDLEntry">filter</td><td class="CDLDefinition"><p>a string containing descriptions of file filters to look for; each description is some text followed by file masks in parentheses; filters are delimited by \n (%0A), extensions are delimited by &quot;,&quot;; all blanks, pluses, and other non-URI characters must be escaped (e.g., &quot;C++ file&quot; =&gt; &quot;C%2B%2B%20file&quot;)</p><p>Example:&nbsp; &quot;Word%20document%20(*.doc,*.rtf)%0AC%2B%2B%20file(*.cpp,*.h,*.hpp)&quot;, which decodes to &quot;Word document (*.doc,*.rtf)\nC++ file(*.cpp,*.h,*.hpp)&quot;.</p></td></tr><tr><td class="CDLEntry">browse_id</td><td class="CDLDefinition"><p>some id representing the file browse dialog; can be used to distinguish multiple dialogs when the return value is recevied via a HTML5 message; a good suggestion is to use the current timestamp</p></td></tr><tr><td class="CDLEntry">start_dir</td><td class="CDLDefinition"><p>the directory to start with (relative to the user's home)</p></td></tr></table><p>URL example for the FileDialog.html iframe:</p><pre>/apps/filedialog/FileDialog.html?type=open&amp;filter=Word%<span class="SHNumber">20document</span>%<span class="SHNumber">20</span>(*.doc,*.rtf)%<span class="SHNumber">0AC</span>%<span class="SHNumber">2B</span>%<span class="SHNumber">2B</span>%<span class="SHNumber">20file</span>(*.cpp,*.h,*.hpp)&amp;browse_id=<span class="SHNumber">12345</span></pre><p>An example of the full iframe tag:</p><pre>&lt;iframe id=<span class="SHString">'theiframe'</span> style=<span class="SHString">'width:700px;height:465px;'</span> src=<span class="SHString">'/apps/filedialog/FileDialog.html?type=open&amp;filter=Word%20document%20(*.doc,*.rtf)&amp;browse_id=12345'</span>&gt;<br />&lt;/iframe&gt;</pre></div>
</div>

<a name="Getting_the_Chosen_File_Name"></a><a name="Topic52"></a><div class="CTopic TGroup LTextFile">
 <div class="CTitle">Getting the Chosen File Name</div>
 <div class="CBody"><p>When the file has been selected, FileDialog.html sends back a HTML5 message to its parent frame (the caller):</p><pre>window.parent.postMessage({protocol:<span class="SHString">&quot;file_dialog_result&quot;</span>, browse_id:<span class="SHString">&quot;{passed_browse_id}&quot;</span>, result: &lt;chosen_file_name_relative_to_user<span class="SHString">'s_home&gt;}, &quot;*&quot;);</span></pre><p>If the Cancel button is pressed, the message will be:</p><pre>window.parent.postMessage({protocol:<span class="SHString">&quot;file_dialog_result&quot;</span>, browse_id:<span class="SHString">&quot;{passed_browse_id}&quot;</span>, result: <span class="SHString">&quot;&quot;</span>}, <span class="SHString">&quot;*&quot;</span>);</pre><p>An example of the function for receiving the dialog result:</p><pre>&lt;script&gt;<br /><span class="SHKeyword">var</span> receiveMessage2 = <span class="SHKeyword">function</span>(<span class="SHKeyword">event</span>) {<br />  <span class="SHKeyword">if</span> (<span class="SHKeyword">event</span>.data.browse_id!=<span class="SHString">&quot;12345&quot;</span>) <span class="SHKeyword">return</span>;<br />  alert(<span class="SHKeyword">event</span>.data.result); // here is your file name<br />};<br /><br />window.addEventListener(<span class="SHString">&quot;message&quot;</span>, receiveMessage2, <span class="SHKeyword">true</span>);<br />&lt;/script&gt;</pre></div>
</div>

<a name="Destroying_the_file_dialog"></a><a name="Topic101"></a><div class="CTopic TGroup LTextFile last">
 <div class="CTitle">Destroying the file dialog</div>
 <div class="CBody"><p>The FileDailog app does not destroy its iframe, neither does it react to outer &quot;x&quot; buttons that can be provided by the outer window or div.</p><p>It is your responsibility to destroy the iframe containing the dialog. For example, you can just remove the iframe element from the DOM. If you use some outer window for the iframe, you should destroy it as well.</p><p>If you have the &quot;x&quot; button in the outer window, you must implement the corresponding event handler (in this case, assume the dialog result is &quot;&quot;; notice that this result won't be sent by the FileDialog app, since it knows nothing about the outer window).</p></div>
</div>

</body></html>