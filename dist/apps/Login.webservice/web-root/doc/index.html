<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Login Service API.txt</title><link rel="stylesheet" type="text/css" href="Default.css" /><script type="text/javascript" src="../../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0.2 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Login_Service_API"></a><a name="Topic68"></a><div class="CTopic TFile LTextFile first">
 <div class="CTitle">Login Service API</div>
</div>

<a name="Introduction"></a><a name="Topic69"></a><div class="CTopic TGroup LTextFile">
 <div class="CTitle">Introduction</div>
 <div class="CBody"><p>The &quot;login&quot; service is responsible for registering and authenticating users as well as for password recovery. The service is mainly used by the &quot;login&quot; app. Links sent during e-mail verification (as a part of the sign up or password recovery process) will also point to the login service.</p><p>All character encodings must be UTF-8.</p><p>It is strongly recommended to access the login service via the HTTPS connection.</p></div>
</div>

<a name="Access_URL"></a><a name="Topic70"></a><div class="CTopic TGroup LTextFile">
 <div class="CTitle">Access URL</div>
 <div class="CBody"><p>The login service is accessible via the following URL:</p><pre>https://[domain_or_ip]/services/login/</pre></div>
</div>

<a name="Methods"></a><a name="Topic71"></a><div class="CTopic TGroup LTextFile">
 <div class="CTitle">Methods</div>
</div>

<a name="signup_allowed"></a><a name="Topic72"></a><div class="CTopic TFunction LTextFile">
 <div class="CTitle">signup_allowed</div>
 <div id="NDPrototype72" class="NDPrototype NoParameterForm">GET https://[domain_or_ip]/services/login/signup_allowed</div>
 <div class="CBody"><p>Used to find out whether to display the &quot;Register Now&quot; or similar option for new users.</p><div class="CHeading">Returns</div><p>whether the <a href="../../../index.html#File:API_Specifications/APIs_of_Bundled_Apps___Services/Login_Service_API.txt:signup_policy" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,136);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >signup_policy</a> setting in service.properties is not equal to &quot;deny&quot;</p></div>
</div>

<a name="recaptcha_site_key"></a><a name="Topic73"></a><div class="CTopic TFunction LTextFile">
 <div class="CTitle">recaptcha_site_key</div>
 <div id="NDPrototype73" class="NDPrototype NoParameterForm">GET https://[domain_or_ip]/services/login/recaptcha_site_key</div>
 <div class="CBody"><p>Used by client-side code (in the login app) to initialize reCAPTCHA.</p><div class="CHeading">Returns</div><p>the value of the <b>recaptcha_site_key</b> property (see <a href="../../../index.html#File:API_Specifications/APIs_of_Bundled_Apps___Services/Login_Service_API.txt:CAPTCHA-specific_properties" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,91);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >CAPTCHA-specific properties</a>); if empty, then no captcha required</p></div>
</div>

<a name="verify"></a><a name="Topic74"></a><div class="CTopic TFunction LTextFile">
 <div class="CTitle">verify</div>
 <div id="NDPrototype74" class="NDPrototype NoParameterForm">GET https://[domain_or_ip]/services/login/verify/[login]/[emailed_token]</div>
 <div class="CBody"><p>Used to verify the token e-mailed during the sign up process (if <a href="../../../index.html#File:API_Specifications/APIs_of_Bundled_Apps___Services/Login_Service_API.txt:signup_policy" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,136);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >signup_policy</a> equals to &quot;email&quot;).</p><div class="CHeading">Returns</div><p>a redirect to a HTML displaying the verification status.</p></div>
</div>

<a name="signup"></a><a name="Topic75"></a><div class="CTopic TFunction LTextFile">
 <div class="CTitle">signup</div>
 <div id="NDPrototype75" class="NDPrototype NoParameterForm">POST https://[domain_or_ip]/services/login/signup/</div>
 <div class="CBody"><pre>Content-Type: application/x-www-form-urlencoded</pre><p>Registers a new user. Depending on <a href="../../../index.html#File:API_Specifications/APIs_of_Bundled_Apps___Services/Login_Service_API.txt:signup_policy" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,136);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >signup_policy</a>, can send an e-mail to verify the e-mail address.</p><p>Data fields:</p><table class="CDefinitionList"><tr><td class="CDLEntry">* g-recaptcha-response</td><td class="CDLDefinition"><p>reCAPTCHA response</p></td></tr><tr><td class="CDLEntry">* password</td><td class="CDLDefinition"><p>user's password</p></td></tr><tr><td class="CDLEntry">* email</td><td class="CDLDefinition"><p>user's email</p></td></tr><tr><td class="CDLEntry">* desired_login</td><td class="CDLDefinition"><p>desired login (can be changed automatically by the login service); the desired_login will be checked for allowed symbols; in addition, the login &quot;standalone&quot; cannot be registered (some symbols will be appended)</p></td></tr></table><div class="CHeading">Returns</div><p>a redirect to a HTML displaying the result.</p></div>
</div>

<a name="signin"></a><a name="Topic76"></a><div class="CTopic TFunction LTextFile">
 <div class="CTitle">signin</div>
 <div id="NDPrototype76" class="NDPrototype NoParameterForm">POST https://[domain_or_ip]/services/login/signin/?[redirect-URL]</div>
 <div class="CBody"><pre>Content-Type: application/x-www-form-urlencoded</pre><p>Signs in the given user and redirects to certain page on success.</p><p>Data fields:</p><table class="CDefinitionList"><tr><td class="CDLEntry">* login</td><td class="CDLDefinition"><p>user name or alias</p></td></tr><tr><td class="CDLEntry">* password</td><td class="CDLDefinition"><p>user's password</p></td></tr><tr><td class="CDLEntry">* remember (optional)</td><td class="CDLDefinition"><p>whether ws_token should expire after 1 year (default is 1 hour)</p></td></tr></table><p>The &lt;redirect&gt; query string value is optional. It can contain any URL (having symbols &quot;:&quot; and &quot;?&quot;), where the login service should redirect to on successful sign in. If not specified, the URL for the default desktop app will be used.</p><div class="CHeading">Returns</div><p>a redirect response to the given [redirect-URL] (or the desktop app URL) with the appended query values &quot;login&quot; and &quot;ws_token&quot;.</p><p>On error, redirects to a page with the error message.</p><p>If the password has expired, redirects to the password recovery page.</p></div>
</div>

<a name="signin_token"></a><a name="Topic77"></a><div class="CTopic TFunction LTextFile">
 <div class="CTitle">signin_token</div>
 <div id="NDPrototype77" class="NDPrototype NoParameterForm">POST https://[domain_or_ip]/services/login/signin_token/</div>
 <div class="CBody"><pre>Content-Type: application/x-www-form-urlencoded</pre><p>Signs in the given user and returns a JSON with the ws_token, which can be used to access other webAppOS functionality.</p><p>Data fields are the same as for the <a href="../../../index.html#File:API_Specifications/APIs_of_Bundled_Apps___Services/Login_Service_API.txt:signin" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,76);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >signin</a> method.</p><div class="CHeading">Returns</div><p>A JSON in the format:</p><pre>{<br />  <span class="SHString">&quot;login&quot;</span>: <span class="SHString">&quot;{login}&quot;</span>,<br />  <span class="SHString">&quot;ws_token&quot;</span>: <span class="SHString">&quot;{ws_token}&quot;</span>,<br />  <span class="SHString">&quot;expires&quot;</span>: <span class="SHString">&quot;{stringified-UTC-date}&quot;</span>,<br />  <span class="SHString">&quot;redirect&quot;</span>: <span class="SHString">&quot;{the redirect URL}&quot;</span> // the same URL as <span class="SHKeyword">in</span> the &lt;signin&gt; method<br />}</pre><p>or</p><pre>{<br />  <span class="SHString">&quot;error&quot;</span>: <span class="SHString">&quot;{message}&quot;</span><br />}</pre><p>in case of error.</p><p>If an empty string is returned, or a stringified JSON contains the &quot;error&quot; attribute, then an error occurred. The caller script can display an error message or vibrate the login/password field.&nbsp; If the&nbsp; password has expired, only redirect attribute is returned.</p></div>
</div>

<a name="check_ws_token"></a><a name="Topic78"></a><div class="CTopic TFunction LTextFile">
 <div class="CTitle">check_ws_token</div>
 <div id="NDPrototype78" class="NDPrototype NoParameterForm">POST https://[domain_or_ip]/services/login/check_ws_token/</div>
 <div class="CBody"><pre>Content-Type: application/x-www-form-urlencoded</pre><p>Validates the given login+ws_token. Checks whether the given ws_token is valid and not expired.&nbsp; Used by webappos_scopes driver to automatically sign in users, for whom the login+ws_token is found in browser localStorage.</p><p>Data fields:</p><table class="CDefinitionList"><tr><td class="CDLEntry">* login</td><td class="CDLDefinition"><p>user login</p></td></tr><tr><td class="CDLEntry">* ws_token</td><td class="CDLDefinition"><p>user's ws_token</p></td></tr></table><div class="CHeading">Returns</div><p>a JSON</p><pre>{<br />  <span class="SHString">&quot;result&quot;</span>: <span class="SHString">&quot;true&quot;</span><br />}</pre><p>on success, or</p><pre>{<br />  <span class="SHString">&quot;result&quot;</span>: <span class="SHString">&quot;false&quot;</span>,<br />  <span class="SHString">&quot;error&quot;</span>: <span class="SHString">&quot;{message}&quot;</span><br />}</pre><p>on error</p></div>
</div>

<a name="signout"></a><a name="Topic79"></a><div class="CTopic TFunction LTextFile">
 <div class="CTitle">signout</div>
 <div id="NDPrototype79" class="NDPrototype NoParameterForm">POST https://[domain_or_ip]/services/login/signout/</div>
 <div class="CBody"><pre>Content-Type: application/x-www-form-urlencoded</pre><p>Signs out the given user (destroys the given server-side ws_token).</p><p>Data fields:</p><table class="CDefinitionList"><tr><td class="CDLEntry">* login</td><td class="CDLDefinition"><p>user login</p></td></tr><tr><td class="CDLEntry">* ws_token</td><td class="CDLDefinition"><p>user's ws_token</p></td></tr></table><div class="CHeading">Returns</div><p>nothing</p></div>
</div>

<a name="password_reset_request"></a><a name="Topic80"></a><div class="CTopic TFunction LTextFile">
 <div class="CTitle">password_reset_request</div>
 <div id="NDPrototype80" class="NDPrototype NoParameterForm">POST https://[domain_or_ip]/services/login/password_reset_request/</div>
 <div class="CBody"><pre>Content-Type: application/x-www-form-urlencoded</pre><p>Sends an e-mail with a password reset link (if the provided e-mail address is associated with some user).</p><p>Data fields:</p><table class="CDefinitionList"><tr><td class="CDLEntry">* email</td><td class="CDLDefinition"><p>user's e-mail, where to send the reset link</p></td></tr><tr><td class="CDLEntry">* g-recaptcha-response</td><td class="CDLDefinition"><p>reCAPTCHA response</p></td></tr></table><div class="CHeading">Returns</div><p>a redirect to a HTML page with the result.</p></div>
</div>

<a name="change_password"></a><a name="Topic81"></a><div class="CTopic TFunction LTextFile">
 <div class="CTitle">change_password</div>
 <div id="NDPrototype81" class="NDPrototype NoParameterForm">POST https://[domain_or_ip]/services/login/change_password/</div>
 <div class="CBody"><pre>Content-Type: application/x-www-form-urlencoded</pre><p>Changes the user's password, given the old and new passwords.</p><p>Data fields:</p><table class="CDefinitionList"><tr><td class="CDLEntry">* login</td><td class="CDLDefinition"><p>user's login</p></td></tr><tr><td class="CDLEntry">* g-recaptcha-response</td><td class="CDLDefinition"><p>reCAPTCHA response</p></td></tr><tr><td class="CDLEntry">* old_password</td><td class="CDLDefinition"><p>old password</p></td></tr><tr><td class="CDLEntry">* new_password</td><td class="CDLDefinition"><p>new password</p></td></tr></table><div class="CHeading">Returns</div><p>a redirect to a HTML page with the result.</p></div>
</div>

<a name="service.properties_for_the_login_service"></a><a name="Topic82"></a><div class="CTopic TGroup LTextFile">
 <div class="CTitle">service.properties for the login service</div>
</div>

<a name="signup_policy"></a><a name="Topic136"></a><div class="CTopic TEnumeration LTextFile">
 <div class="CTitle">signup_policy</div>
 <div class="CBody"><pre>signup_policy=email</pre><p>Supported values:</p><table class="CDefinitionList"><tr><td class="CDLEntry"><a name="signup_policy.*deny"></a><a name="Topic137"></a>* deny</td><td class="CDLDefinition"><p>signup not allowed (but the admin can add users manually via the registry or via the admin script)</p></td></tr><tr><td class="CDLEntry"><a name="signup_policy.*manual"></a><a name="Topic138"></a>* manual</td><td class="CDLDefinition"><p>signup is allowed, but the admin has to approve the user manually (in the registry or via the admin script)</p></td></tr><tr><td class="CDLEntry"><a name="signup_policy.*email"></a><a name="Topic86"></a>* email</td><td class="CDLDefinition"><p>signup is allowed, but the e-mail has to be validated by sending a secret link to the user</p></td></tr><tr><td class="CDLEntry"><a name="signup_policy.*allow"></a><a name="Topic87"></a>* allow</td><td class="CDLDefinition"><p>signup is always allowed (do not use this option, unless you use CAPTCHA, see <a href="../../../index.html#File:API_Specifications/APIs_of_Bundled_Apps___Services/Login_Service_API.txt:CAPTCHA-specific_properties" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,91);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >CAPTCHA-specific properties</a>)</p></td></tr><tr><td class="CDLEntry"><a name="signup_policy.*email+manual"></a><a name="Topic139"></a>* email+manual</td><td class="CDLDefinition"><p>signup is allowed, but the e-mail address has to be verified AND then the admin has to approve (unblock) the user manually</p></td></tr><tr><td class="CDLEntry"><a name="signup_policy.*webcall_"></a><a name="Topic140"></a>* webcall:&lt;actionName&gt;</td><td class="CDLDefinition"><p>signup is allowed, but the given web call (conforming to jsoncall calling conventions) will hadle the signup request; the function must &quot;convert&quot; the signup request to one of the previous 4 values by returning a stringified JSON with the &quot;result&quot; attribute with one of the following values: &quot;deny&quot;|&quot;manual&quot;|&quot;email&quot;|&quot;email+manual&quot;|&quot;allow&quot;.&nbsp; In addition, the function can add the &quot;error&quot; attribute, e.g.</p></td></tr></table><pre>{<br />    <span class="SHString">&quot;result&quot;</span>: <span class="SHString">&quot;deny&quot;</span>,<br />    <span class="SHString">&quot;error&quot;</span>: <span class="SHString">&quot;Password too short&quot;</span><br />}</pre></div>
</div>

<a name="password_expire_days"></a><a name="Topic89"></a><div class="CTopic TEnumeration LTextFile">
 <div class="CTitle">password_expire_days</div>
 <div class="CBody"><pre>password_expire_days=<span class="SHNumber">401500</span></pre><p>Specifies the password expire time in days (1100 years by default).</p></div>
</div>

<a name="signup_inverval_minutes"></a><a name="Topic90"></a><div class="CTopic TEnumeration LTextFile">
 <div class="CTitle">signup_inverval_minutes</div>
 <div class="CBody"><pre>signup_inverval_minutes=<span class="SHNumber">10</span></pre><p>Specifies how long the user has to wait before attempting to sign up once again.</p></div>
</div>

<a name="CAPTCHA-specific_properties"></a><a name="Topic91"></a><div class="CTopic TEnumeration LTextFile last">
 <div class="CTitle">CAPTCHA-specific properties</div>
 <div class="CBody"><pre>recaptcha_site_key=<span class="SHNumber">6LdFsj</span>...<br />recaptcha_secret_key=<span class="SHNumber">6LdFsj</span>...<br />recaptcha_verify_url=https://www.google.com/recaptcha/api/siteverify</pre><p>If the recaptcha_site_key and recaptcha_secret_key properties are specified, the login app and the login service will use reCAPTCHA to protect against robots that could register users automatically.&nbsp; Values for these two properties can be obtained from Google at <a href="https://www.google.com/recaptcha/admin" target="_top">https://&#8203;www&#8203;.google&#8203;.com&#8203;/recaptcha&#8203;/admin</a>.&nbsp; Please, specify the correct domain there.</p><p>The last property (recaptcha_verify_url) specifies the URL used by the service to verify the solved captcha. This URL should remain constant (unless Google changes it).</p></div>
</div>

</body></html>